<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PPL Ultimate Tracker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0; /* Slate 200 */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Hide Scrollbar but keep functionality */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Input styling */
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .active-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- DATA PROGRAM ---
        const PROGRAM_DATA = {
            1: {
                name: "PUSH (Strength)",
                target: "Bench naik, Triceps kuat",
                exercises: [
                    { id: 'p1_1', name: 'Incline Bench Press Machine', sets: 5, reps: '4', weight: '85-90' },
                    { id: 'p1_2', name: 'Flat Barbell Bench Press', sets: 4, reps: '5', weight: '70-80' },
                    { id: 'p1_3', name: 'Seated Shoulder Press Machine', sets: 3, reps: '6-8', weight: '40-55' },
                    { id: 'p1_4', name: 'Chest Fly / Pec Deck', sets: 3, reps: '12', weight: '45-60' },
                    { id: 'p1_5', name: 'Triceps Pushdown (Cable)', sets: 3, reps: '10-12', weight: '30-40' }
                ]
            },
            2: {
                name: "PULL",
                target: "Back tebal & lebar",
                exercises: [
                    { id: 'p2_1', name: 'Lat Pulldown / Pull Up', sets: 4, reps: '6-8', weight: '65-80' },
                    { id: 'p2_2', name: 'Chest-Supported Row Machine', sets: 4, reps: '6-8', weight: '60-80' },
                    { id: 'p2_3', name: 'Seated Cable Row', sets: 3, reps: '8-10', weight: '55-70' },
                    { id: 'p2_4', name: 'Face Pull', sets: 3, reps: '12-15', weight: '20-30' },
                    { id: 'p2_5', name: 'EZ Bar Curl', sets: 3, reps: '8-10', weight: '25-35' }
                ]
            },
            3: {
                name: "LEGS (HNP Safe)",
                target: "Kaki kuat, Pinggang aman",
                exercises: [
                    { id: 'p3_1', name: 'Leg Press', sets: 4, reps: '8-10', weight: '180-240' },
                    { id: 'p3_2', name: 'Bulgarian Split Squat', sets: 3, reps: '8', weight: '22-26' },
                    { id: 'p3_3', name: 'Deadlift (Controlled)', sets: 4, reps: '4', weight: '120-130', note: 'PR Max 155kg' },
                    { id: 'p3_4', name: 'Seated / Lying Leg Curl', sets: 3, reps: '10-12', weight: '35-50' },
                    { id: 'p3_5', name: 'Standing Calf Raise', sets: 4, reps: '12-15', weight: '70-100' }
                ]
            },
            4: {
                name: "REST DAY",
                type: "rest",
                target: "Balikin CNS & Sendi",
                checklist: [
                    "Jalan cepat / Sepeda santai (20-30 min)",
                    "Mobility Pinggul & Thoracic",
                    "Core Ringan (McGill Big 3)",
                    "Tidur 7-8 Jam"
                ]
            },
            5: {
                name: "UPPER (Volume)",
                target: "Growth tanpa capek saraf",
                exercises: [
                    { id: 'p5_1', name: 'Incline Bench Machine', sets: 4, reps: '8', weight: '75-80' },
                    { id: 'p5_2', name: 'Cable Row', sets: 3, reps: '10', weight: '55-70' },
                    { id: 'p5_3', name: 'Chest Fly Machine', sets: 3, reps: '12', weight: '45-60' },
                    { id: 'p5_4', name: 'Lateral Raise (DB)', sets: 4, reps: '15', weight: '10-12' },
                    { id: 'p5_5', name: 'Overhead Triceps Ext', sets: 3, reps: '12', weight: '25-35' },
                    { id: 'p5_6', name: 'EZ Bar / Machine Curl', sets: 3, reps: '12', weight: '20-30' }
                ]
            },
            6: {
                name: "LOWER (Hypertrophy)",
                target: "Kaki isi & Conditioning",
                exercises: [
                    { id: 'p6_1', name: 'Hack Squat / Pendulum', sets: 4, reps: '10', weight: '60-100' },
                    { id: 'p6_2', name: 'Hip Thrust', sets: 3, reps: '8-10', weight: '90-120' },
                    { id: 'p6_3', name: 'RDL (Ringan & Rapi)', sets: 3, reps: '8', weight: '90-100' },
                    { id: 'p6_4', name: 'Leg Extension / Step Up', sets: 3, reps: '12', weight: '35-50' },
                    { id: 'p6_5', name: 'Seated Calf Raise', sets: 4, reps: '15', weight: '40-60' }
                ]
            },
            0: { // Sunday (0 in JS Date)
                name: "OFF / CARDIO",
                type: "rest",
                target: "Opsional Zone 2",
                checklist: [
                    "Cardio Zone 2 (30-40 Menit)",
                    "Stretching Total",
                    "Persiapan Meal Plan Minggu Depan"
                ]
            }
        };

        const DAYS_MAP = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];

        // --- ICONS (Lucide Wrapper) ---
        const Icon = ({ name, size = 20, className = "" }) => {
            const lucideIcon = window.lucide?.icons?.[name];
            if (!lucideIcon) return null;
            
            return (
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width={size}
                    height={size}
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    className={className}
                    dangerouslySetInnerHTML={{ __html: lucideIcon.toSvg() }} // Simplified rendering for CDN version
                />
            );
        };

        // --- COMPONENTS ---

        // 1. WAKE LOCK HOOK
        const useWakeLock = () => {
            const wakeLock = useRef(null);

            const requestWakeLock = async () => {
                if ('wakeLock' in navigator) {
                    try {
                        wakeLock.current = await navigator.wakeLock.request('screen');
                        console.log('Screen Wake Lock active');
                    } catch (err) {
                        console.error(`${err.name}, ${err.message}`);
                    }
                }
            };

            const releaseWakeLock = async () => {
                if (wakeLock.current) {
                    await wakeLock.current.release();
                    wakeLock.current = null;
                }
            };

            useEffect(() => {
                document.addEventListener('visibilitychange', async () => {
                    if (wakeLock.current !== null && document.visibilityState === 'visible') {
                        await requestWakeLock();
                    }
                });
                return () => releaseWakeLock();
            }, []);

            return { requestWakeLock, releaseWakeLock };
        };

        // 2. MAIN APP
        const App = () => {
            const [view, setView] = useState('dashboard'); // dashboard, workout, history, rules
            const [history, setHistory] = useState([]);
            const [recoveryScore, setRecoveryScore] = useState(100);
            const [activeDay, setActiveDay] = useState(new Date().getDay());
            const [userData, setUserData] = useState({ name: 'Athlete', weight: 75 });
            const [streak, setStreak] = useState(0);

            // Load Data
            useEffect(() => {
                const savedHistory = localStorage.getItem('ppl_history');
                const savedRecovery = localStorage.getItem('ppl_recovery');
                const savedUserData = localStorage.getItem('ppl_user');
                
                if (savedHistory) setHistory(JSON.parse(savedHistory));
                if (savedRecovery) setRecoveryScore(parseInt(savedRecovery));
                if (savedUserData) setUserData(JSON.parse(savedUserData));

                // Calculate streak based on history
                // (Simplified logic for demo)
                if (savedHistory) {
                    const parsed = JSON.parse(savedHistory);
                    setStreak(parsed.length);
                }
            }, []);

            // Save Data Helpers
            const saveHistory = (newSession) => {
                const updated = [newSession, ...history];
                setHistory(updated);
                localStorage.setItem('ppl_history', JSON.stringify(updated));
                setStreak(prev => prev + 1);
            };

            const updateRecovery = (val) => {
                setRecoveryScore(val);
                localStorage.setItem('ppl_recovery', val);
            };

            // Fullscreen Handler
            const toggleFullScreen = () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch((e) => console.log(e));
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            };

            // View Renderer
            const renderView = () => {
                switch(view) {
                    case 'dashboard':
                        return <Dashboard 
                            activeDay={activeDay} 
                            setActiveDay={setActiveDay}
                            startWorkout={() => setView('workout')} 
                            recoveryScore={recoveryScore}
                            updateRecovery={updateRecovery}
                            streak={streak}
                            history={history}
                        />;
                    case 'workout':
                        return <ActiveWorkout 
                            dayId={activeDay} 
                            onFinish={(session) => {
                                saveHistory(session);
                                setView('dashboard');
                            }}
                            onCancel={() => setView('dashboard')}
                            history={history}
                        />;
                    case 'history':
                        return <HistoryView history={history} onBack={() => setView('dashboard')} />;
                    case 'rules':
                        return <RulesView onBack={() => setView('dashboard')} />;
                    default:
                        return <Dashboard />;
                }
            };

            return (
                <div className="min-h-screen pb-20 relative">
                    {/* Top Bar */}
                    <div className="flex justify-between items-center p-4 glass-panel sticky top-0 z-50">
                        <h1 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">
                            PPL PRO
                        </h1>
                        <button onClick={toggleFullScreen} className="p-2 rounded-full bg-slate-800 text-slate-400 hover:text-white">
                            <i data-lucide="maximize" className="w-5 h-5"></i>
                        </button>
                    </div>

                    {renderView()}

                    {/* Bottom Nav */}
                    {view === 'dashboard' && (
                        <nav className="fixed bottom-0 left-0 right-0 glass-panel border-t border-slate-700 flex justify-around p-3 z-50">
                            <NavBtn icon="home" label="Home" active={view === 'dashboard'} onClick={() => setView('dashboard')} />
                            <NavBtn icon="history" label="History" active={view === 'history'} onClick={() => setView('history')} />
                            <NavBtn icon="book-open" label="Rules" active={view === 'rules'} onClick={() => setView('rules')} />
                        </nav>
                    )}
                </div>
            );
        };

        const NavBtn = ({ icon, label, active, onClick }) => (
            <button onClick={onClick} className={`flex flex-col items-center gap-1 ${active ? 'text-blue-400' : 'text-slate-500'}`}>
                <i data-lucide={icon} className="w-6 h-6"></i>
                <span className="text-xs">{label}</span>
            </button>
        );

        // 3. DASHBOARD COMPONENT
        const Dashboard = ({ activeDay, setActiveDay, startWorkout, recoveryScore, updateRecovery, streak, history }) => {
            const program = PROGRAM_DATA[activeDay];
            const isRest = program.type === 'rest';

            // Get last workout date
            const lastWorkout = history.length > 0 ? new Date(history[0].date).toLocaleDateString('id-ID', { weekday: 'long' }) : '-';

            // Lucide icons need re-rendering when component mounts
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [activeDay]);

            return (
                <div className="p-4 space-y-6">
                    {/* Date Selector */}
                    <div className="flex justify-between items-center bg-slate-800 p-2 rounded-xl">
                        <button onClick={() => setActiveDay(d => d === 0 ? 6 : d - 1)} className="p-2"><i data-lucide="chevron-left"></i></button>
                        <div className="text-center">
                            <div className="text-xs text-slate-400">PROGRAM HARI INI</div>
                            <div className="font-bold text-lg text-white">{DAYS_MAP[activeDay]}</div>
                        </div>
                        <button onClick={() => setActiveDay(d => d === 6 ? 0 : d + 1)} className="p-2"><i data-lucide="chevron-right"></i></button>
                    </div>

                    {/* Main Card */}
                    <div className={`rounded-2xl p-6 relative overflow-hidden ${isRest ? 'bg-gradient-to-br from-emerald-900 to-slate-900' : 'bg-gradient-to-br from-blue-900 to-slate-900'}`}>
                        <div className="relative z-10">
                            <h2 className="text-3xl font-black italic uppercase mb-1">{program.name}</h2>
                            <p className="text-sm text-slate-300 mb-6">{program.target}</p>
                            
                            {isRest ? (
                                <div className="space-y-2">
                                    <div className="text-emerald-400 font-bold flex items-center gap-2">
                                        <i data-lucide="coffee"></i> RECOVERY MODE
                                    </div>
                                    <p className="text-xs text-slate-400">Gunakan checklist di bawah untuk pemulihan optimal.</p>
                                </div>
                            ) : (
                                <button onClick={startWorkout} className="w-full active-btn text-white font-bold py-4 rounded-xl text-lg flex items-center justify-center gap-2 animate-pulse">
                                    <i data-lucide="dumbbell"></i>
                                    MULAI LATIHAN
                                </button>
                            )}
                        </div>
                        {/* Decor */}
                        <div className="absolute -right-5 -bottom-5 text-white opacity-5 transform rotate-12">
                            <i data-lucide={isRest ? "battery-charging" : "activity"} width={150} height={150}></i>
                        </div>
                    </div>

                    {/* Stats Grid */}
                    <div className="grid grid-cols-2 gap-4">
                        <div className="bg-slate-800 p-4 rounded-xl">
                            <div className="text-slate-400 text-xs mb-1">TOTAL WORKOUT</div>
                            <div className="text-2xl font-bold text-white">{streak}</div>
                            <div className="text-xs text-emerald-400 mt-1">Konsisten! üî•</div>
                        </div>
                        <div className="bg-slate-800 p-4 rounded-xl">
                            <div className="text-slate-400 text-xs mb-1">RECOVERY LEVEL</div>
                            <input 
                                type="range" 
                                min="0" max="100" 
                                value={recoveryScore} 
                                onChange={(e) => updateRecovery(e.target.value)}
                                className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500"
                            />
                            <div className="flex justify-between mt-1">
                                <span className="text-xs text-red-400">Sakit</span>
                                <span className="text-sm font-bold">{recoveryScore}%</span>
                                <span className="text-xs text-emerald-400">Segar</span>
                            </div>
                        </div>
                    </div>

                    {/* Rest Day Checklist */}
                    {isRest && (
                        <div className="bg-slate-800 rounded-xl p-4">
                            <h3 className="font-bold mb-3 flex items-center gap-2"><i data-lucide="list-checks" className="w-4 h-4"></i> Checklist Pemulihan</h3>
                            <div className="space-y-3">
                                {program.checklist.map((item, idx) => (
                                    <label key={idx} className="flex items-start gap-3 p-2 hover:bg-slate-700 rounded-lg cursor-pointer">
                                        <input type="checkbox" className="mt-1 w-5 h-5 rounded accent-emerald-500" />
                                        <span className="text-sm text-slate-300">{item}</span>
                                    </label>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 4. ACTIVE WORKOUT COMPONENT
        const ActiveWorkout = ({ dayId, onFinish, onCancel, history }) => {
            const { requestWakeLock } = useWakeLock();
            const program = PROGRAM_DATA[dayId];
            const [startTime] = useState(Date.now());
            const [timer, setTimer] = useState(0);
            const [exerciseData, setExerciseData] = useState({});
            const [restTimer, setRestTimer] = useState(0);
            const [isResting, setIsResting] = useState(false);

            // Wake Lock on Mount
            useEffect(() => {
                requestWakeLock();
            }, []);

            // Global Timer
            useEffect(() => {
                const interval = setInterval(() => {
                    setTimer(Math.floor((Date.now() - startTime) / 1000));
                }, 1000);
                return () => clearInterval(interval);
            }, []);

            // Rest Timer
            useEffect(() => {
                let interval;
                if (isResting && restTimer > 0) {
                    interval = setInterval(() => setRestTimer(t => t - 1), 1000);
                } else if (restTimer === 0) {
                    setIsResting(false);
                }
                return () => clearInterval(interval);
            }, [isResting, restTimer]);

            // Initialize Exercise Inputs
            useEffect(() => {
                const initialData = {};
                program.exercises.forEach(ex => {
                    // Try to find last weight from history
                    let lastWeight = '';
                    const lastSession = history.find(h => h.programId === dayId.toString());
                    if (lastSession && lastSession.exercises[ex.id]) {
                        // Get the weight from the first set of the last session for this exercise
                         lastWeight = lastSession.exercises[ex.id][0]?.weight || '';
                    }

                    initialData[ex.id] = Array(ex.sets).fill({ weight: lastWeight, reps: '', completed: false });
                });
                setExerciseData(initialData);
            }, []); // Run once

            const updateSet = (exId, setIdx, field, value) => {
                const newData = { ...exerciseData };
                newData[exId][setIdx] = { ...newData[exId][setIdx], [field]: value };
                setExerciseData(newData);
            };

            const toggleSetComplete = (exId, setIdx) => {
                const newData = { ...exerciseData };
                const isComplete = !newData[exId][setIdx].completed;
                newData[exId][setIdx].completed = isComplete;
                setExerciseData(newData);
                
                if (isComplete) {
                    startRest(90); // Default 90s rest
                }
            };

            const startRest = (seconds) => {
                setRestTimer(seconds);
                setIsResting(true);
            };

            const formatTime = (seconds) => {
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                return `${m}:${s < 10 ? '0' : ''}${s}`;
            };

            const finishSession = () => {
                const sessionData = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    programName: program.name,
                    programId: dayId.toString(),
                    duration: timer,
                    exercises: exerciseData
                };
                onFinish(sessionData);
            };

            // Get Last Weight Helper
            const getLastWeight = (exId) => {
                 const lastSession = history.find(h => h.programId === dayId.toString());
                 if (!lastSession || !lastSession.exercises[exId]) return null;
                 // Return the max weight used in last session
                 const weights = lastSession.exercises[exId].map(s => parseFloat(s.weight) || 0);
                 return Math.max(...weights);
            };

            // Re-init icons
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });

            return (
                <div className="flex flex-col h-screen bg-slate-900 absolute top-0 left-0 w-full z-50 overflow-hidden">
                    {/* Header */}
                    <div className="bg-slate-800 p-4 shadow-lg flex justify-between items-center z-10">
                        <div>
                            <h2 className="font-bold text-white leading-tight">{program.name}</h2>
                            <div className="text-emerald-400 font-mono text-sm">{formatTime(timer)}</div>
                        </div>
                        <button onClick={finishSession} className="bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-2 rounded-lg font-bold text-sm">
                            SELESAI
                        </button>
                    </div>

                    {/* Scrollable Content */}
                    <div className="flex-1 overflow-y-auto p-4 space-y-6 pb-32 no-scrollbar">
                        {program.exercises?.map((ex) => {
                            const lastWeight = getLastWeight(ex.id);
                            return (
                                <div key={ex.id} className="bg-slate-800/50 rounded-xl p-4 border border-slate-700/50">
                                    <div className="flex justify-between items-start mb-3">
                                        <div>
                                            <h3 className="font-bold text-lg text-blue-100">{ex.name}</h3>
                                            <div className="text-xs text-slate-400">Target: {ex.sets} set x {ex.reps} reps @ {ex.weight}kg</div>
                                            {lastWeight && <div className="text-xs text-amber-400 mt-1">Last: {lastWeight}kg</div>}
                                            {ex.note && <div className="text-xs text-red-300 mt-1 font-bold">‚ö†Ô∏è {ex.note}</div>}
                                        </div>
                                    </div>

                                    <div className="space-y-2">
                                        <div className="grid grid-cols-10 gap-2 text-xs text-slate-500 text-center uppercase font-bold mb-1">
                                            <div className="col-span-1">Set</div>
                                            <div className="col-span-3">KG</div>
                                            <div className="col-span-3">Reps</div>
                                            <div className="col-span-3">Done</div>
                                        </div>
                                        {Array.from({ length: ex.sets }).map((_, idx) => {
                                            const set = exerciseData[ex.id]?.[idx] || {};
                                            return (
                                                <div key={idx} className={`grid grid-cols-10 gap-2 items-center transition-all ${set.completed ? 'opacity-50' : 'opacity-100'}`}>
                                                    <div className="col-span-1 text-center font-mono text-slate-400">{idx + 1}</div>
                                                    <div className="col-span-3">
                                                        <input 
                                                            type="number" 
                                                            placeholder={lastWeight || "-"}
                                                            value={set.weight || ''}
                                                            onChange={(e) => updateSet(ex.id, idx, 'weight', e.target.value)}
                                                            className="w-full bg-slate-900 border border-slate-700 rounded p-2 text-center text-white focus:border-blue-500 outline-none"
                                                        />
                                                    </div>
                                                    <div className="col-span-3">
                                                        <input 
                                                            type="number" 
                                                            placeholder={ex.reps.split('-')[0]} // Take lower bound
                                                            value={set.reps || ''}
                                                            onChange={(e) => updateSet(ex.id, idx, 'reps', e.target.value)}
                                                            className="w-full bg-slate-900 border border-slate-700 rounded p-2 text-center text-white focus:border-blue-500 outline-none"
                                                        />
                                                    </div>
                                                    <div className="col-span-3">
                                                        <button 
                                                            onClick={() => toggleSetComplete(ex.id, idx)}
                                                            className={`w-full p-2 rounded flex justify-center items-center ${set.completed ? 'bg-emerald-600' : 'bg-slate-700'}`}
                                                        >
                                                            <i data-lucide="check" className="w-4 h-4 text-white"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* Footer Controls */}
                    <div className="bg-slate-900 border-t border-slate-800 p-4 fixed bottom-0 left-0 w-full z-20">
                         {isResting ? (
                             <div className="bg-blue-900/80 rounded-xl p-3 flex justify-between items-center backdrop-blur-md border border-blue-500/30">
                                 <div className="flex items-center gap-3">
                                     <div className="p-2 bg-blue-600 rounded-full animate-pulse">
                                        <i data-lucide="clock" className="w-5 h-5 text-white"></i>
                                     </div>
                                     <div>
                                         <div className="text-xs text-blue-200 uppercase tracking-wider">Resting</div>
                                         <div className="text-2xl font-mono font-bold text-white">{formatTime(restTimer)}</div>
                                     </div>
                                 </div>
                                 <div className="flex gap-2">
                                     <button onClick={() => setRestTimer(t => t + 30)} className="bg-slate-700 text-white px-3 py-1 rounded text-sm">+30s</button>
                                     <button onClick={() => setRestTimer(0)} className="bg-slate-700 text-white px-3 py-1 rounded text-sm">Skip</button>
                                 </div>
                             </div>
                         ) : (
                             <button onClick={onCancel} className="w-full py-3 text-slate-500 font-bold text-sm">
                                BATALKAN SESI
                             </button>
                         )}
                    </div>
                </div>
            );
        };

        // 5. HISTORY COMPONENT
        const HistoryView = ({ history, onBack }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });

            return (
                <div className="p-4 space-y-4">
                    <button onClick={onBack} className="flex items-center text-slate-400 gap-2 mb-4">
                        <i data-lucide="arrow-left"></i> Kembali
                    </button>
                    <h2 className="text-2xl font-bold text-white mb-4">Riwayat Latihan</h2>
                    
                    {history.length === 0 ? (
                        <div className="text-center text-slate-500 py-10">Belum ada data latihan.</div>
                    ) : (
                        history.map((session) => (
                            <div key={session.id} className="bg-slate-800 rounded-xl p-4 border border-slate-700">
                                <div className="flex justify-between items-start mb-2">
                                    <div>
                                        <div className="font-bold text-white">{session.programName}</div>
                                        <div className="text-xs text-slate-400">
                                            {new Date(session.date).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                                        </div>
                                    </div>
                                    <div className="text-emerald-400 font-mono text-sm">
                                        {Math.floor(session.duration / 60)} min
                                    </div>
                                </div>
                                {/* Summary Stats */}
                                <div className="text-xs text-slate-500">
                                    Total Volume: {
                                        Object.values(session.exercises).flat().reduce((acc, curr) => acc + (curr.completed ? (curr.weight * curr.reps) : 0), 0)
                                    } kg
                                </div>
                            </div>
                        ))
                    )}
                </div>
            );
        };

        // 6. RULES VIEW
        const RulesView = ({ onBack }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });
            
            return (
                 <div className="p-4 space-y-6">
                    <button onClick={onBack} className="flex items-center text-slate-400 gap-2 mb-4">
                        <i data-lucide="arrow-left"></i> Kembali
                    </button>
                    
                    <h2 className="text-2xl font-bold text-white">Aturan Progresi</h2>
                    
                    <div className="space-y-4">
                        <div className="bg-blue-900/30 border border-blue-500/30 p-4 rounded-xl">
                            <h3 className="font-bold text-blue-300 mb-2">üìà Kenaikan Beban</h3>
                            <ul className="list-disc pl-5 text-sm text-slate-300 space-y-2">
                                <li><strong>Compound:</strong> +2.5 kg tiap 1-2 minggu.</li>
                                <li><strong>Isolation:</strong> +2-5 kg tiap 2-3 minggu.</li>
                                <li>Jika repetisi target tercapai dengan form sempurna, naikkan beban.</li>
                            </ul>
                        </div>

                        <div className="bg-red-900/30 border border-red-500/30 p-4 rounded-xl">
                            <h3 className="font-bold text-red-300 mb-2">üö® Tanda Harus Turun Beban</h3>
                            <ul className="list-disc pl-5 text-sm text-slate-300 space-y-2">
                                <li>Bench lebih terasa di bahu daripada dada.</li>
                                <li>Pinggang pegal &gt;48 jam setelah Deadlift.</li>
                                <li>Kekuatan drop drastis.</li>
                                <li>Tidur & mood anjlok.</li>
                            </ul>
                            <div className="mt-3 text-xs bg-red-900/50 p-2 rounded text-red-200">
                                Solusi: Turun beban 5-10kg, perbaiki form.
                            </div>
                        </div>

                        <div className="bg-amber-900/30 border border-amber-500/30 p-4 rounded-xl">
                            <h3 className="font-bold text-amber-300 mb-2">üõë Aturan Deload</h3>
                            <p className="text-sm text-slate-300">
                                Jika beban stuck selama 2 minggu berturut-turut, lakukan deload selama 1 minggu (kurangi volume/beban sebesar 30%).
                            </p>
                        </div>
                    </div>
                 </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
